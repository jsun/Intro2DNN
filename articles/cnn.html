<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to image recognition with deep learning • Intro2DNN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to image recognition with deep learning">
<meta property="og:description" content="Intro2DNN">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Intro2DNN</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cnn.html">Introduction to image recognition with deep learning</a>
    </li>
    <li>
      <a href="../articles/cnn_zh.html">物体识别入门</a>
    </li>
    <li>
      <a href="../articles/lstm.html">Prediction of CRISPR guide RNA activity with deep learning</a>
    </li>
    <li>
      <a href="../articles/lstm_ja.html">深層学習を利用した CRISPR guide RNA の活性予測</a>
    </li>
    <li>
      <a href="../articles/lstm_zh.html">基于深度学习预测 CRISPR guide RNA 的切割效率</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jsun/Intro2DNN">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cnn_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to image recognition with deep learning</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jsun/Intro2DNN/blob/master/vignettes/cnn.Rmd"><code>vignettes/cnn.Rmd</code></a></small>
      <div class="hidden name"><code>cnn.Rmd</code></div>

    </div>

    
    
<div id="abstract" class="section level2">
<h2 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h2>
<p>Convolutional neural network (CNN) is one of the deep neural network architectures used for image recognition. In contrast to the traditional machine learning methods that require humans to manually specify the features of objects such as color, size, aspect ratio, and so on, CNNs can automatically extract that feature by learning a large number of images. Thus, building an image recognition model using CNN requires only collecting a large number of images without developing new algorithms to extract features. Today, this simple and easy method is popular in many research areas. In this workshop, we will learn how to use an R package named torch to build CNN models for image recognition.</p>
<div id="goals-and-objectives" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-and-objectives" class="anchor"></a>Goals and Objectives</h3>
<p>The workshop introduces fundamental concepts of one of CNN algorithms through developing a simple model to perform image recognition. By the end of the workshop, participants should be able to:</p>
<ul>
<li>understand fundamental concepts of neural network</li>
<li>understand fundamental concepts of CNN</li>
<li>develop an deep neural network model with programming language R</li>
</ul>
</div>
<div id="prerequisties" class="section level3">
<h3 class="hasAnchor">
<a href="#prerequisties" class="anchor"></a>Prerequisties</h3>
<p>The workshop will proceed on the assumption that participants have the following basic knowledge:</p>
<ul>
<li>basic knowledge of R syntax (package installation, reading and writing files, <code>for</code> sentence, functions)</li>
<li>basic knowledge of mathematics (multivariate functions, linear combinations, differentiation, etc.)</li>
</ul>
<p>Since the workshop focuses on explaining basic knowledge of deep learning, it is not intended for those who are familiar with deep learning or who can build models with Python or other programming languages.</p>
</div>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>In this workshop, we mainly use torch <span class="citation">(PBC 2021)</span> and coro <span class="citation">(Henry 2021)</span> to perform deep learning, use jpeg package for preprocessing image data, and use tidyverse package for data summarization and visualization. To install these packages, run the following scripts.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'jpeg'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'tidyverse'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'coro'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'torch'</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://torch.mlverse.org/docs">'torch'</a></span><span class="op">)</span>
<span class="fu"><a href="https://torch.mlverse.org/docs/reference/install_torch.html">install_torch</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1200</span><span class="op">)</span></code></pre></div>
<p>Then, we restart R session and load these packages.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.rforge.net/jpeg/">'jpeg'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">'tidyverse'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-lib/coro">'coro'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://torch.mlverse.org/docs">'torch'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://torchvision.mlverse.org">'torchvision'</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="dataset-preparation-and-preprocessing" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset-preparation-and-preprocessing" class="anchor"></a>Dataset Preparation and preprocessing</h2>
<div id="dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h3>
<p>In this workshop, we use <a href="https://www.tensorflow.org/datasets/catalog/tf_flowers">tf_flower</a> as an exmaple image dataset to learn how to build and how to use image recognition models. The dataset can be downloaded from TensorFlow datasets website with the following functions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">'flower_photos'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="st">"train_photos"</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="st">"train_photos_train"</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="st">"train_photos_valid"</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">tf_flowers</span> <span class="op">&lt;-</span> <span class="st">'https://storage.googleapis.com/download.tensorflow.org/example_images/flower_photos.tgz'</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">tf_flowers</span>, destfile <span class="op">=</span> <span class="st">'flower_photos.tgz'</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/untar.html">untar</a></span><span class="op">(</span><span class="st">'flower_photos.tgz'</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">'flower_photos'</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span><span class="op">(</span><span class="st">'flower_photos/LICENSE.txt'</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">'flower_photos/sunflowers'</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="preprocessing" class="section level3">
<h3 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h3>
<p>In order to get an overview of the data, we first summarize the number of categories and the number of images in each category.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">class</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">'flower_photos'</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">train_images</span><span class="op">[[</span><span class="va">class</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'flower_photos'</span>, <span class="va">class</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">train_images</span><span class="op">)</span>,
           n_images <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">train_images</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span>, y <span class="op">=</span> <span class="va">n_images</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">'identity'</span><span class="op">)</span></code></pre></div>
<p>We can see that there are five categories, daisy, dandelion, roses, sunflowers, and tulips in this dataset, and each category contains more than 600 images.</p>
<p>To perform model training and validation with this dataset, first of all, we split the dataset into two subset: training subset and validation subset. To reduce training time in this workshop, we only select 20 images for training and 10 images for validaiton.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_train_images</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">n_valid_images</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">class_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'dandelion'</span>, <span class="st">'sunflowers'</span>, <span class="st">'roses'</span>, <span class="st">'tulips'</span>, <span class="st">'daisy'</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">'flower_photos_train'</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">'flower_photos_valid'</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">class</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">train_images</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">class</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">class_labels</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'flower_photos_train'</span>, <span class="va">class</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'flower_photos_valid'</span>, <span class="va">class</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">train_images</span><span class="op">[[</span><span class="va">class</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&lt;=</span> <span class="va">n_train_images</span><span class="op">)</span> <span class="op">{</span>
                <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'flower_photos'</span>, <span class="va">class</span>, <span class="va">train_images</span><span class="op">[[</span><span class="va">class</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'flower_photos_train'</span>, <span class="va">class</span>, <span class="va">train_images</span><span class="op">[[</span><span class="va">class</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
            <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">n_train_images</span> <span class="op">&lt;</span> <span class="va">i</span> <span class="op">&amp;&amp;</span> <span class="va">i</span> <span class="op">&lt;=</span> <span class="va">n_train_images</span> <span class="op">+</span> <span class="va">n_valid_images</span><span class="op">)</span> <span class="op">{</span>
                <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'flower_photos'</span>, <span class="va">class</span>, <span class="va">train_images</span><span class="op">[[</span><span class="va">class</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'flower_photos_valid'</span>, <span class="va">class</span>, <span class="va">train_images</span><span class="op">[[</span><span class="va">class</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Then, we define pre-processes pipeline to process images during training and validation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_transforms</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">img</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_to_tensor.html">transform_to_tensor</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_resize.html">transform_resize</a></span><span class="op">(</span><span class="va">img</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">512</span>, <span class="fl">512</span><span class="op">)</span><span class="op">)</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_random_resized_crop.html">transform_random_resized_crop</a></span><span class="op">(</span><span class="va">img</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">224</span>, <span class="fl">224</span><span class="op">)</span><span class="op">)</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_color_jitter.html">transform_color_jitter</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_random_horizontal_flip.html">transform_random_horizontal_flip</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_normalize.html">transform_normalize</a></span><span class="op">(</span><span class="va">img</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.485</span>, <span class="fl">0.456</span>, <span class="fl">0.406</span><span class="op">)</span>, std <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.229</span>, <span class="fl">0.224</span>, <span class="fl">0.225</span><span class="op">)</span><span class="op">)</span>
    <span class="va">img</span>
<span class="op">}</span>

<span class="va">valid_transforms</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">img</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_to_tensor.html">transform_to_tensor</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_resize.html">transform_resize</a></span><span class="op">(</span><span class="va">img</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">256</span>, <span class="fl">256</span><span class="op">)</span><span class="op">)</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_center_crop.html">transform_center_crop</a></span><span class="op">(</span><span class="va">img</span>, <span class="fl">224</span><span class="op">)</span>
    <span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_normalize.html">transform_normalize</a></span><span class="op">(</span><span class="va">img</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.485</span>, <span class="fl">0.456</span>, <span class="fl">0.406</span><span class="op">)</span>, std <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.229</span>, <span class="fl">0.224</span>, <span class="fl">0.225</span><span class="op">)</span><span class="op">)</span>
    <span class="va">img</span>
<span class="op">}</span></code></pre></div>
<p>At the last step, we use <code>image_folder_dataset</code> function to automatically collect training images from the given folder, and use <code>dataloader</code> to manage datasets during the training.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/image_folder_dataset.html">image_folder_dataset</a></span><span class="op">(</span><span class="st">'flower_photos_train'</span>, transform <span class="op">=</span> <span class="va">train_transforms</span><span class="op">)</span>
<span class="va">dataset_train</span><span class="op">$</span><span class="va">classes</span>
<span class="va">dataloader_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/dataloader.html">dataloader</a></span><span class="op">(</span><span class="va">dataset_train</span>, batch_size <span class="op">=</span> <span class="fl">2</span>, shuffle <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="modeling" class="section level2">
<h2 class="hasAnchor">
<a href="#modeling" class="anchor"></a>Modeling</h2>
<div id="model-architectures" class="section level3">
<h3 class="hasAnchor">
<a href="#model-architectures" class="anchor"></a>Model Architectures</h3>
<p>The first step of model construction with torch package is to design architecture of neural networks. Here, we design a neural network that receives an image and output <code>length(dataset_train$classes)</code> values which can be considered as score for each category. Specifically, we will design 7-layers CNN, 4-layers composed of convolutional layers and pooling layers for feature extraction and 3 full connected layers for classification.</p>
<p>To design the network architecture, we follow the definitions of torch to create a class with <code>initialize</code> and <code>forward</code> functions. The <code>initialize</code> function declares the components of the network. On the other hand, the <code>forward</code> function defines the order in which the components are connected.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SimpleCNN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_module.html">nn_module</a></span><span class="op">(</span>
    <span class="st">"SimpleCNN"</span>,
    
    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_classes</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">self</span><span class="op">$</span><span class="va">conv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_conv2d.html">nn_conv2d</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">16</span>, <span class="fl">5</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">pool1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_max_pool2d.html">nn_max_pool2d</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">conv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_conv2d.html">nn_conv2d</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">32</span>, <span class="fl">5</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">pool2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_max_pool2d.html">nn_max_pool2d</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>
      
        <span class="va">n_inputs</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="fl">224</span> <span class="op">-</span> <span class="fl">5</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">*</span> <span class="fl">32</span>

        <span class="va">self</span><span class="op">$</span><span class="va">fc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html">nn_linear</a></span><span class="op">(</span>in_features <span class="op">=</span> <span class="va">n_inputs</span>, out_features <span class="op">=</span> <span class="fl">512</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">fc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html">nn_linear</a></span><span class="op">(</span>in_features <span class="op">=</span> <span class="fl">512</span>, out_features <span class="op">=</span> <span class="fl">64</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">fc3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html">nn_linear</a></span><span class="op">(</span>in_features <span class="op">=</span> <span class="fl">64</span>, out_features <span class="op">=</span> <span class="va">n_classes</span><span class="op">)</span>
    <span class="op">}</span>,
  
    forward <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">conv1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_relu.html">nnf_relu</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">pool1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">conv2</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_relu.html">nnf_relu</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">pool2</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
      
        <span class="co"># convert a matrix to a vector</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_flatten.html">torch_flatten</a></span><span class="op">(</span><span class="va">x</span>, start_dim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
      
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">fc1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_relu.html">nnf_relu</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">fc2</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_relu.html">nnf_relu</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">fc3</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span>
    <span class="op">}</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="model-training" class="section level3">
<h3 class="hasAnchor">
<a href="#model-training" class="anchor"></a>Model Training</h3>
<p>In this subsection, we will create an instance from the model architecture and assign the dataset for model training. Here is an example for creating an instance from the <code>SimpleCNN</code> class.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">SimpleCNN</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dataset_train</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To train the model, we specify a training algorithm and a loss function in advance. Since the cross entropy loss function is commonly used for classification problems, we use this function as a loss function to train model. In addition, we will use Adam’s algorithm to optimize the model, which is one of the popular algorithms in most situations.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">criterion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_cross_entropy_loss.html">nn_cross_entropy_loss</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">optimizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/optim_adam.html">optim_adam</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></code></pre></div>
<p>Next, we send the prepared datasets and the model to a device (CPU or GPU) for training. Here, we use <code>for</code> statement to train 5 epochs with the same dataset. At each epoch, we train the model with each of the minibatches defined by <code>dataloader</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span>
<span class="va">model</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="op">)</span>

<span class="va">loss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">epoch</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="fl">0</span>

    <span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">dataloader_train</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span>
        <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu">criterion</span><span class="op">(</span><span class="va">output</span>, <span class="va">b</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span>
        
        <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="va">loss_running</span> <span class="op">+</span> <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
        <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="va">n_train_samples</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="va">loss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">loss_train</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"epoch %d  loss: %3f\n"</span>, <span class="va">epoch</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>From the figure, we can see that the training loss decreased during training.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>epoch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">loss_train</span><span class="op">)</span>, loss <span class="op">=</span> <span class="va">loss_train</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epoch</span>, y <span class="op">=</span> <span class="va">loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>To refine the model, training process can be performed more times. Let us train the model more 5 epochs.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">epoch</span> <span class="kw">in</span> <span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="fl">0</span>

    <span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">dataloader_train</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span>
        <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu">criterion</span><span class="op">(</span><span class="va">output</span>, <span class="va">b</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span>
        
        <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="va">loss_running</span> <span class="op">+</span> <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
        <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="va">n_train_samples</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="va">loss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">loss_train</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"epoch %d  loss: %3f\n"</span>, <span class="va">epoch</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>epoch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">loss_train</span><span class="op">)</span>, loss <span class="op">=</span> <span class="va">loss_train</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epoch</span>, y <span class="op">=</span> <span class="va">loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="popular-architectures" class="section level2">
<h2 class="hasAnchor">
<a href="#popular-architectures" class="anchor"></a>Popular Architectures</h2>
<p>Some popular CNN architectures are implemented in torch package, and user can calls the architecture without self-definition. Here is an example to load ResNet, one of popular CNN, and to train the network. As ResNet consists of a huge amount of parameters, it take more times for training.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/model_resnet18.html">model_resnet18</a></span><span class="op">(</span>pretrained <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">num_features</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">fc</span><span class="op">$</span><span class="va">in_features</span>
<span class="va">model</span><span class="op">$</span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html">nn_linear</a></span><span class="op">(</span>in_features <span class="op">=</span> <span class="va">num_features</span>, out_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dataset_train</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span><span class="op">)</span>
<span class="va">criterion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_cross_entropy_loss.html">nn_cross_entropy_loss</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">optimizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/optim_sgd.html">optim_sgd</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">parameters</span>, lr <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">loss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">epoch</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="fl">0</span>

    <span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">dataloader_train</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span>
        <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu">criterion</span><span class="op">(</span><span class="va">output</span>, <span class="va">b</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span>
        
        <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="va">loss_running</span> <span class="op">+</span> <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
        <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="va">n_train_samples</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="va">loss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">loss_train</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"epoch %d  loss: %3f\n"</span>, <span class="va">epoch</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>epoch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">loss_train</span><span class="op">)</span>, loss <span class="op">=</span> <span class="va">loss_train</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epoch</span>, y <span class="op">=</span> <span class="va">loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="model-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#model-validation" class="anchor"></a>Model Validation</h3>
<p>Here we use the validation dataset to validate the model performance. The procedures for validation is the same as that for training. Thus, (i) preprocess datasets and create <code>dataloader</code>, and (ii) assign the <code>dastaloader</code> to the model. At the beginning of validation, we here prepare a validation dataset.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/image_folder_dataset.html">image_folder_dataset</a></span><span class="op">(</span><span class="st">'flower_photos_valid'</span>, transform <span class="op">=</span> <span class="va">valid_transforms</span><span class="op">)</span>
<span class="va">dataset_valid</span><span class="op">$</span><span class="va">classes</span>
<span class="va">dataloader_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/dataloader.html">dataloader</a></span><span class="op">(</span><span class="va">dataset_valid</span>, batch_size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Then, same as training steps, we use <code>for</code> statement to assign the validation dataset to the model, and retrieve the prediction results. Note that, switching the model to validation mode (evaluation mode) enables to improve the calculation speed during validation.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span>

<span class="va">y_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">y_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">loss_valid</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">n_valid_samples</span>  <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">dataloader_valid</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
    <span class="va">output_class_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_argmax.html">torch_argmax</a></span><span class="op">(</span><span class="va">output</span>, dim<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
    
    <span class="va">y_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y_true</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
    <span class="va">y_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y_pred</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">output_class_id</span><span class="op">)</span><span class="op">)</span>
      
    <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu">criterion</span><span class="op">(</span><span class="va">output</span>, <span class="va">b</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
    <span class="va">loss_valid</span> <span class="op">&lt;-</span> <span class="va">loss_valid</span> <span class="op">+</span> <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
    <span class="va">n_valid_samples</span> <span class="op">&lt;-</span> <span class="va">n_valid_samples</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">loss_valid</span> <span class="op">&lt;-</span> <span class="va">loss_valid</span> <span class="op">/</span> <span class="va">n_valid_samples</span>
<span class="va">acc_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">y_true</span> <span class="op">==</span> <span class="va">y_pred</span><span class="op">)</span> <span class="op">/</span> <span class="va">n_valid_samples</span>
<span class="va">acc_valid</span></code></pre></div>
<p>Then we plot a scatter chart to visualize the correlation between predicted values and the true values.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">y_true</span>, predicted <span class="op">=</span> <span class="va">y_pred</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">label</span>, <span class="va">predicted</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_images <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predicted</span>, y <span class="op">=</span> <span class="va">label</span>, fill <span class="op">=</span> <span class="va">n_images</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="inference" class="section level3">
<h3 class="hasAnchor">
<a href="#inference" class="anchor"></a>Inference</h3>
<p>In this subsection, we show an example to inference against a new image. We load an image with jpeg package, preprocess the image with <code>valid_transforms</code> pipeline, and input the image to the trained model. The output from the model is real numbers which can be converted to probability-like values.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">'flower_photos/sunflowers/9410186154_465642ed35.jpg'</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">jpeg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jpeg/man/readJPEG.html">readJPEG</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">valid_transforms</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="va">x_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">x_batch</span><span class="op">[</span><span class="fl">1</span>,,,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">as.array</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x_batch_tensor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="va">x_batch</span><span class="op">)</span>

<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">x_batch_tensor</span><span class="op">)</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span>

<span class="va">output</span>

<span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_softmax.html">nnf_softmax</a></span><span class="op">(</span><span class="va">output</span>, dim<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset_train</span><span class="op">$</span><span class="va">classes</span></code></pre></div>
</div>
</div>
<div id="saving-and-loading" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-and-loading" class="anchor"></a>Saving and Loading</h2>
<p>The trained model can be saved with <code>torch_save</code> function. Note that models saved with the standard <code>save</code> function will be environment-dependent, and results in that you are not able to call the model in other environments (computers).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_save.html">torch_save</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">'my_model.pth'</span><span class="op">)</span></code></pre></div>
<p>The model can be loaded with <code>torch_load</code> function from a file. Models loaded by <code>torch_load</code> function can be used for inference or retraining.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mymodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_load.html">torch_load</a></span><span class="op">(</span><span class="st">'my_model.pth'</span><span class="op">)</span>
<span class="va">mymodel</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="st">'flower_photos/sunflowers/9410186154_465642ed35.jpg'</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">jpeg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jpeg/man/readJPEG.html">readJPEG</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">valid_transforms</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="va">x_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">x_batch</span><span class="op">[</span><span class="fl">1</span>,,,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">as.array</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x_batch_tensor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="va">x_batch</span><span class="op">)</span>

<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">x_batch_tensor</span><span class="op">)</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span>

<span class="va">output</span>

<span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_softmax.html">nnf_softmax</a></span><span class="op">(</span><span class="va">output</span>, dim<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
<div id="system-environment" class="section level2">
<h2 class="hasAnchor">
<a href="#system-environment" class="anchor"></a>System Environment</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; ─ Session info  ──────────────────────────────────────────────────────────────</span>
<span class="co">#&gt;  hash: cinema, right-facing fist: dark skin tone, yellow square</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  setting  value</span>
<span class="co">#&gt;  version  R Under development (unstable) (2021-10-28 r81109)</span>
<span class="co">#&gt;  os       Ubuntu 20.04.3 LTS</span>
<span class="co">#&gt;  system   x86_64, linux-gnu</span>
<span class="co">#&gt;  ui       X11</span>
<span class="co">#&gt;  language (EN)</span>
<span class="co">#&gt;  collate  en_US.UTF-8</span>
<span class="co">#&gt;  ctype    en_US.UTF-8</span>
<span class="co">#&gt;  tz       Etc/UTC</span>
<span class="co">#&gt;  date     2021-10-31</span>
<span class="co">#&gt;  pandoc   2.14.0.3 @ /usr/local/bin/ (via rmarkdown)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ─ Packages ───────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt;  package     * version date (UTC) lib source</span>
<span class="co">#&gt;  cachem        1.0.6   2021-08-19 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  callr         3.7.0   2021-04-20 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  cli           3.1.0   2021-10-27 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  crayon        1.4.2   2021-10-29 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  desc          1.4.0   2021-09-28 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  devtools    * 2.4.2   2021-06-07 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  digest        0.6.28  2021-09-23 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  ellipsis      0.3.2   2021-04-29 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  evaluate      0.14    2019-05-28 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  fastmap       1.1.0   2021-01-25 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  fs            1.5.0   2020-07-31 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  glue          1.4.2   2020-08-27 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  htmltools     0.5.2   2021-08-25 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  knitr         1.36    2021-09-29 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  lifecycle     1.0.1   2021-09-24 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  magrittr      2.0.1   2020-11-17 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  memoise       2.0.0   2021-01-26 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  pkgbuild      1.2.0   2020-12-15 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  pkgdown       1.6.1   2020-09-12 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  pkgload       1.2.3   2021-10-13 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  prettyunits   1.1.1   2020-01-24 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  processx      3.5.2   2021-04-30 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  ps            1.6.0   2021-02-28 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  purrr         0.3.4   2020-04-17 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  R6            2.5.1   2021-08-19 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  ragg          1.2.0   2021-10-30 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  remotes       2.4.1   2021-09-29 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  rlang         0.4.12  2021-10-18 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  rmarkdown     2.11    2021-09-14 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  rprojroot     2.0.2   2020-11-15 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  sessioninfo   1.2.0   2021-10-31 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  stringi       1.7.5   2021-10-04 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  stringr       1.4.0   2019-02-10 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  systemfonts   1.0.3   2021-10-13 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  testthat      3.1.0   2021-10-04 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  textshaping   0.3.6   2021-10-13 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  usethis     * 2.1.3   2021-10-27 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  withr         2.4.2   2021-04-18 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  xfun          0.27    2021-10-18 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt;  yaml          2.2.1   2020-02-01 [2] CRAN (R 4.2.0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  [1] /tmp/RtmpvfiGT9/temp_libpath2a344ca05124</span>
<span class="co">#&gt;  [2] /usr/local/lib/R/site-library</span>
<span class="co">#&gt;  [3] /usr/local/lib/R/library</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ──────────────────────────────────────────────────────────────────────────────</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-coro" class="csl-entry">
Henry, Lionel. 2021. <span>“Coro: ’Coroutines’ for r.”</span> <a href="ttps://cran.r-project.org/package=coro">ttps://cran.r-project.org/package=coro</a>.
</div>
<div id="ref-torch4r" class="csl-entry">
PBC, RStudio. 2021. <span>“Torch for r.”</span> <a href="https://torch.mlverse.org/">https://torch.mlverse.org/</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jianqiang Sun.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
