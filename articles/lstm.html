<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prediction of CRISPR guide RNA activity with deep learning • Intro2DNN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Prediction of CRISPR guide RNA activity with deep learning">
<meta property="og:description" content="Intro2DNN">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Intro2DNN</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cnn.html">Introduction to image recognition with deep learning</a>
    </li>
    <li>
      <a href="../articles/cnn_zh.html">物体识别入门</a>
    </li>
    <li>
      <a href="../articles/lstm.html">Prediction of CRISPR guide RNA activity with deep learning</a>
    </li>
    <li>
      <a href="../articles/lstm_ja.html">深層学習を利用した CRISPR guide RNA の活性予測</a>
    </li>
    <li>
      <a href="../articles/lstm_zh.html">基于深度学习预测 CRISPR guide RNA 的切割效率</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jsun/Intro2DNN">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lstm_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Prediction of CRISPR guide RNA activity with deep learning</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jsun/Intro2DNN/blob/master/vignettes/lstm.Rmd"><code>vignettes/lstm.Rmd</code></a></small>
      <div class="hidden name"><code>lstm.Rmd</code></div>

    </div>

    
    
<div id="abstract" class="section level2">
<h2 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h2>
<p>Deep learning has proven to be one of the state-of-the-art tools in object recognition and natural language processing, and has been applied to many fields including life sciences. Deep learning refers to the use of multiple layers of neural network which is one of the traditional machine learning algorithms. Deep neural networks are able to solve problems that are difficult to solve with conventional machine learning algorithms. At present, various architectures of deep neural networks have been published, especially convolutional neural networks (CNN) and recurrent neural networks (RNN) are well-known. The former is known to be excellent in computer visions such as object recognition and object detection, while the latter, RNN, is known to be excellent in time-series data analysis and natural language processing. Considering many Bioconductor users are familiar with genome sequence analysis, in this workshop, we will focus on RNN, and introduce the fundamental algorithm of RNN and procedures to build RNN models using R.</p>
<div id="goals-and-objectives" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-and-objectives" class="anchor"></a>Goals and Objectives</h3>
<p>The workshop introduces fundamental concepts of RNN algorithms and long short-term memory (LSTM), through developing a model to predict CRISPR guide RNA activity with a nucleotide sequence of guide RNA. By the end of the workshop, participants should be able to:</p>
<ul>
<li>understand fundamental concepts of neural network</li>
<li>understand fundamental concepts of RNN</li>
<li>develop an deep neural network model with programming language R</li>
</ul>
</div>
<div id="prerequisties" class="section level3">
<h3 class="hasAnchor">
<a href="#prerequisties" class="anchor"></a>Prerequisties</h3>
<p>The workshop will proceed on the assumption that participants have the basic knowledge:</p>
<ul>
<li>basic knowledge of R syntax (package installation, reading and writing files, <code>for</code> sentence, functions)</li>
<li>basic knowledge of mathematics (multivariate functions, linear combinations, differentiation, etc.)</li>
</ul>
<p>Since the workshop focuses on explaining of basic knowledge about deep learning, it is not intended for those who are familiar with deep learning or who can build models with Python or other programming languages.</p>
</div>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>In this workshop, we mainly use torch <span class="citation">(PBC 2021)</span> and coro <span class="citation">(Henry 2021)</span> packages to perform deep learning, and use tidyverse package for visualization. To install these packages, run the following scripts.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'tidyverse'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'coro'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'torch'</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://torch.mlverse.org/docs">'torch'</a></span><span class="op">)</span>
<span class="fu"><a href="https://torch.mlverse.org/docs/reference/install_torch.html">install_torch</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1200</span><span class="op">)</span></code></pre></div>
<p>Then, restart R session and load these packages.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">'tidyverse'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-lib/coro">'coro'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://torch.mlverse.org/docs">'torch'</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="dataset-preparation-and-preprocessing" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset-preparation-and-preprocessing" class="anchor"></a>Dataset Preparation and preprocessing</h2>
<div id="dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h3>
<p>Dataset used in this workshop can be downloaded from Supplementary Data in <span class="citation">Wang D (2019)</span>’s paper. Due to time restraints, we will use the dataset that has already been arranged. The arranged dataset is packaged in Intro2DNN package and also can be downloaded from <a href="https://github.com/jsun/Intro2DNN">GitHub</a>. The dataset contains <em>train.tsv</em> and <em>valid.tsv</em> files, which are the training dataset and validation dataset, respectively.</p>
</div>
<div id="preprocessing" class="section level3">
<h3 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h3>
<p>At first, we will show an example of loading and preprocessing of training dataset <em>train.tsv</em>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_fpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'train.tsv'</span>, package <span class="op">=</span> <span class="st">'Intro2DNN'</span><span class="op">)</span>
<span class="va">crisprcas9_train_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="va">train_fpath</span>, header <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">'\t'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">crisprcas9_train_dataset</span><span class="op">)</span></code></pre></div>
<p>As shown above, <em>train.tsv</em> consists of two columns: the first column is the editing efficiencies of guide RNA, and the second is the nucleotide sequence of guide RNA.</p>
<p>In this workshop, our goal is to create a model to predict the activity by inputting a nucleotide sequence. For convenience, we store the activities into <code>y_train</code> as labels (response variable) and the nucleotide sequences into <code>x_train</code> as features (explanatory variables).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x_train</span> <span class="op">&lt;-</span> <span class="va">crisprcas9_train_dataset</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">crisprcas9_train_dataset</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></code></pre></div>
<p>Since most machine learning packages including torch package require numeric inputs, it is necessary to convert a string (i.e., nucleotide sequence) into numeric values. Based on the requirements of torch package, we convert A, T, C, and G into integers 1, 2, 3, and 4, respectively. Here, as an example, we try to covert the first sequence of <code>x_train</code> with <code>chartr</code> and <code>strsplit</code> functions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">chartr</a></span><span class="op">(</span><span class="st">'ATCG'</span>, <span class="st">'1234'</span>, <span class="va">x_train</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">chartr</a></span><span class="op">(</span><span class="st">'ATCG'</span>, <span class="st">'1234'</span>, <span class="va">x_train</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can see that the 21 nucleotides was successfully converted into 21 integers with <code>chartr</code> and <code>strsplit</code> functions. Next, we use the two functions to convert all sequences in <code>x_train</code> object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">chartr</a></span><span class="op">(</span><span class="st">'ATCG'</span>, <span class="st">'1234'</span>, <span class="va">x_train</span><span class="op">)</span>, <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                  ncol <span class="op">=</span> <span class="fl">21</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x_train</span><span class="op">)</span></code></pre></div>
<p>With the above steps, we successfully loaded data from a file into R object, and converted all sequences into numeric values. Unfortunately, torch package cannot directly handle this type of R object. It is required to create a torch-readable class (a collection of datasets and functions) following torch requirements.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">set_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/dataset.html">dataset</a></span><span class="op">(</span>
    <span class="st">'guidRNA_dataset'</span>,
    
    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">self</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span>
        <span class="va">self</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span>
    <span class="op">}</span>,
    
    .getitem <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">x_tensor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="va">y_tensor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_tensor</span>, y <span class="op">=</span> <span class="va">y_tensor</span><span class="op">)</span>
    <span class="op">}</span>,
    
    .length <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
    <span class="op">}</span>
<span class="op">)</span></code></pre></div>
<p>Then, we assign the training data <code>x_train</code> and <code>y_train</code> to <code>set_dataset</code> class; and we pass <code>set_dataset</code> class object to <code>dataloader</code> to manage datasets during model training.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset_train</span> <span class="op">&lt;-</span> <span class="fu">set_dataset</span><span class="op">(</span><span class="va">x_train</span>, <span class="va">y_train</span><span class="op">)</span>
<span class="va">dataloader_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/dataloader.html">dataloader</a></span><span class="op">(</span><span class="va">dataset_train</span>, batch_size <span class="op">=</span> <span class="fl">1024</span>, shuffle <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="modeling" class="section level2">
<h2 class="hasAnchor">
<a href="#modeling" class="anchor"></a>Modeling</h2>
<div id="model-architecture" class="section level3">
<h3 class="hasAnchor">
<a href="#model-architecture" class="anchor"></a>Model Architecture</h3>
<p>The first step of model construction with torch package is to design architecture of neural networks. Here, we design a neural network with multiple layers that receives 21 integers (features) and outputs one real value (label). Specifically, we design an architecture with three main parts: (i) the first part is composed of an embedding layer that converts 21 integer values to 64 dimension values, (ii) the second part is composed of an LSTM layer which receives 64 values and outputs 256 features, and (iii) the third part is composed of three fully connected layers which receives 256 values and outputs one real value.</p>
<p>To design the network architecture, we follow the definitions of torch to create a class with <code>initialize</code> and <code>forward</code> functions. The <code>initialize</code> function declares the components of the network, and the <code>forward</code> function defines the order in which the components are connected.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GenomicNet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_module.html">nn_module</a></span><span class="op">(</span>
    <span class="st">"GenomicNet"</span>,
  
    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">self</span><span class="op">$</span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_embedding.html">nn_embedding</a></span><span class="op">(</span>num_embeddings <span class="op">=</span> <span class="fl">4</span>, embedding_dim <span class="op">=</span> <span class="fl">64</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">lstm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_lstm.html">nn_lstm</a></span><span class="op">(</span>input_size <span class="op">=</span> <span class="fl">64</span>, hidden_size <span class="op">=</span> <span class="fl">256</span>, batch_first <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">dropout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_dropout.html">nn_dropout</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">fc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html">nn_linear</a></span><span class="op">(</span>in_features <span class="op">=</span> <span class="fl">256</span>, out_features <span class="op">=</span> <span class="fl">512</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">fc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html">nn_linear</a></span><span class="op">(</span>in_features <span class="op">=</span> <span class="fl">512</span>, out_features <span class="op">=</span> <span class="fl">512</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">fc3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nn_linear.html">nn_linear</a></span><span class="op">(</span>in_features <span class="op">=</span> <span class="fl">512</span>, out_features <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">}</span>,
  
    forward <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">embedding</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">lstm</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>, , <span class="op">]</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_relu.html">nnf_relu</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">fc1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">dropout</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_relu.html">nnf_relu</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">fc2</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">dropout</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/nnf_relu.html">nnf_relu</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">fc3</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="model-training" class="section level3">
<h3 class="hasAnchor">
<a href="#model-training" class="anchor"></a>Model Training</h3>
<p>In this subsection, we will create an instance from the model architecture and assign the dataset for model training. Here is an example for creating an instance from the <code>GenomicNet</code> class.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">GenomicNet</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>To train the model, we specify a training algorithm and a loss function in advance. Since our goal is to predict a single real number, we will solve it as a regression problem. Here we will use the mean squared error (MSE) as the loss function. In addition, we will use Adam’s algorithm to optimize the model, which is one of the most popular algorithms in most situations.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">criterion</span> <span class="op">&lt;-</span> <span class="va">nnf_mse_loss</span>
<span class="va">optimizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/optim_adam.html">optim_adam</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></code></pre></div>
<p>Next, we send the prepared datasets and the model to a device (CPU or GPU) for training. Here, we use <code>for</code> statement to train 5 epochs with the same dataset. At each epoch, we train the model with each of the minibatches defined by <code>dataloader</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span>
<span class="va">model</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="op">)</span>

<span class="va">loss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">epoch</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  
    <span class="co"># loop for minibatches</span>
    <span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">dataloader_train</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span>
        <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu">criterion</span><span class="op">(</span><span class="va">output</span>, <span class="va">b</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span>
        
        <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="va">loss_running</span> <span class="op">+</span> <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
        <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="va">n_train_samples</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="va">loss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">loss_train</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"epoch %d  loss: %3f\n"</span>, <span class="va">epoch</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The training loss decreased during training. Further, even at the 5th epoch, the downward trend of the training loss has not weakened. Thus, it is expected that the training loss can be further reduced by setting a larger number of epochs.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>epoch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">loss_train</span><span class="op">)</span>, loss <span class="op">=</span> <span class="va">loss_train</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epoch</span>, y <span class="op">=</span> <span class="va">loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Let us train the model more 5 epochs.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">epoch</span> <span class="kw">in</span> <span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="fl">0</span>

    <span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">dataloader_train</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span>
        <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu">criterion</span><span class="op">(</span><span class="va">output</span>, <span class="va">b</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
        <span class="va">loss</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span>
        <span class="va">optimizer</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span>
        
        <span class="va">loss_running</span> <span class="op">&lt;-</span> <span class="va">loss_running</span> <span class="op">+</span> <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
        <span class="va">n_train_samples</span> <span class="op">&lt;-</span> <span class="va">n_train_samples</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="va">loss_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">loss_train</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"epoch %d  loss: %3f\n"</span>, <span class="va">epoch</span>, <span class="va">loss_running</span> <span class="op">/</span> <span class="va">n_train_samples</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>


<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>epoch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">loss_train</span><span class="op">)</span>, loss <span class="op">=</span> <span class="va">loss_train</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epoch</span>, y <span class="op">=</span> <span class="va">loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#model-validation" class="anchor"></a>Model Validation</h3>
<p>Here we use the validation dataset to validate the model performance. The procedures of data preprocessing for validation is the same as that for training.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">valid_fpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'valid.tsv'</span>, package <span class="op">=</span> <span class="st">'Intro2DNN'</span><span class="op">)</span>
<span class="va">crisprcas9_valid_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="va">valid_fpath</span>, header <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">'\t'</span><span class="op">)</span>

<span class="va">x_valid</span> <span class="op">&lt;-</span> <span class="va">crisprcas9_valid_dataset</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">y_valid</span> <span class="op">&lt;-</span> <span class="va">crisprcas9_valid_dataset</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>

<span class="va">x_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">chartr</a></span><span class="op">(</span><span class="st">'ATCG'</span>, <span class="st">'1234'</span>, <span class="va">x_valid</span><span class="op">)</span>, <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                  ncol <span class="op">=</span> <span class="fl">21</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">dataset_valid</span> <span class="op">&lt;-</span> <span class="fu">set_dataset</span><span class="op">(</span><span class="va">x_valid</span>, <span class="va">y_valid</span><span class="op">)</span>
<span class="va">dataloader_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/dataloader.html">dataloader</a></span><span class="op">(</span><span class="va">dataset_valid</span>, batch_size <span class="op">=</span> <span class="fl">1024</span>, shuffle <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Then, same as the training steps, we use <code>for</code> statement to assign the validation dataset to the model, and retrieve the prediction results. Note that, switching the model to validation mode (evaluation mode) enables to improve the calculation speed during validation.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span>

<span class="va">y_true</span> <span class="op">&lt;-</span> <span class="va">y_valid</span>
<span class="va">y_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">loss_valid</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">n_valid_samples</span>  <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">dataloader_valid</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
    <span class="va">y_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y_pred</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span><span class="op">)</span>
    <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu">criterion</span><span class="op">(</span><span class="va">output</span>, <span class="va">b</span><span class="op">$</span><span class="va">y</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
    
    <span class="va">loss_valid</span> <span class="op">&lt;-</span> <span class="va">loss_valid</span> <span class="op">+</span> <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
    <span class="va">n_valid_samples</span> <span class="op">&lt;-</span> <span class="va">n_valid_samples</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">loss_valid</span> <span class="op">&lt;-</span> <span class="va">loss_valid</span> <span class="op">/</span> <span class="va">n_valid_samples</span>
<span class="va">loss_valid</span></code></pre></div>
<p>Then we plot a scatter chart to visualize the correlation between predicted values and the true values.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">y_true</span>, predicted <span class="op">=</span> <span class="va">y_pred</span><span class="op">)</span> <span class="op"><a href="https://torch.mlverse.org/docs/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">label</span>, y <span class="op">=</span> <span class="va">predicted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>The mean squared error (MSE) was calculated during the validation step, and stored in <code>loss_valid</code> object. In addition, including MSE, the evaluation metrics such as Spearman’s rank correlation coefficient also can be calculated following the definition.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># MSE</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y_true</span> <span class="op">-</span> <span class="va">y_pred</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">)</span>

<span class="co"># correlation</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">y_true</span>, <span class="va">y_pred</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'spearman'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="inference" class="section level3">
<h3 class="hasAnchor">
<a href="#inference" class="anchor"></a>Inference</h3>
<p>In this subsection, we show an example to infer activities of guide RNA with the trained model. To perform inference, the scripts used for validation also can be used as-is. Here, we show another method to infer activity with a single nucleotide sequence of guide RNA.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">'GAGTGATGATGGTCTGCACAC'</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">chartr</a></span><span class="op">(</span><span class="st">'ATCG'</span>, <span class="st">'1234'</span>, <span class="va">x</span><span class="op">)</span>, <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                  ncol <span class="op">=</span> <span class="fl">21</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">x</span>

<span class="va">x_tensor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x_tensor</span>

<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">x_tensor</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span>
<span class="va">y</span></code></pre></div>
</div>
</div>
<div id="saving-and-loading" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-and-loading" class="anchor"></a>Saving and Loading</h2>
<p>The trained model can be saved with <code>torch_save</code> function. Note that models saved with the standard <code>save</code> function will be environment-dependent, and results in that you are not able to call the model in other environments (computers).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_save.html">torch_save</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">'my_model.pth'</span><span class="op">)</span></code></pre></div>
<p>The model can be loaded with <code>torch_load</code> function from a file. Models loaded by <code>torch_load</code> function can be used for inference or retraining.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mymodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_load.html">torch_load</a></span><span class="op">(</span><span class="st">'my_model.pth'</span><span class="op">)</span>
<span class="va">mymodel</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="st">'GAGTGATGATGGTCTGCACAC'</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">chartr</a></span><span class="op">(</span><span class="st">'ATCG'</span>, <span class="st">'1234'</span>, <span class="va">x</span><span class="op">)</span>, <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                  ncol <span class="op">=</span> <span class="fl">21</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">x_tensor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x_tensor</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">mymodel</span><span class="op">(</span><span class="va">x_tensor</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span>device <span class="op">=</span> <span class="st">'cpu'</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span>
<span class="va">y</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-coro" class="csl-entry">
Henry, Lionel. 2021. <span>“Coro: ’Coroutines’ for r.”</span> <a href="ttps://cran.r-project.org/package=coro">ttps://cran.r-project.org/package=coro</a>.
</div>
<div id="ref-torch4r" class="csl-entry">
PBC, RStudio. 2021. <span>“Torch for r.”</span> <a href="https://torch.mlverse.org/">https://torch.mlverse.org/</a>.
</div>
<div id="ref-Wang_2019" class="csl-entry">
Wang D, Wang B, Zhang C. 2019. <span>“Optimized CRISPR Guide RNA Design for Two High-Fidelity Cas9 Variants by Deep Learning.”</span> <em>Nat Commun</em> 10(1): 4284. <a href="https://doi.org/10.1038/s41467-019-12281-8">https://doi.org/10.1038/s41467-019-12281-8</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jianqiang Sun.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
